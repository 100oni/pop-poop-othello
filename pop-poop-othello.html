<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ã‚ªã‚»ãƒ­é¢¨ï¼ˆä¾¿å™¨ vs ã†ã‚“ã“ï¼‰</title>
<style>
  body { font-family: system-ui, sans-serif; text-align: center; background:#eef5f9; }
  #board { display: grid; grid-template-columns: repeat(8, 54px); gap: 2px; margin: 18px auto; width: max-content; }
  .cell {
    width: 54px; height: 54px; background: #6bb1c9; /* ã‚¿ã‚¤ãƒ«è‰² */
    display: flex; align-items: center; justify-content: center; cursor: pointer; border-radius: 6px;
  }
  .piece { font-size: 34px; line-height: 1; }
  .hint { font-size: 12px; color:#555; margin-top:4px; }
</style>
</head>
<body>
<h1>ä¾¿å™¨ vs ã†ã‚“ã“</h1>
<div id="board"></div>
<p>ã‚¿ãƒ¼ãƒ³: <span id="turnLabel">ğŸ’© ã†ã‚“ã“</span></p>
<p class="hint">â€» åè»¢ã§ããªã„å ´æ‰€ã«ã¯ç½®ã‘ã¾ã›ã‚“ï¼ˆ8æ–¹å‘åˆ¤å®šï¼‰ã€‚</p>

<script>
const board = document.getElementById('board');
const turnLabel = document.getElementById('turnLabel');
let turn = 'poop'; // poop(é»’ç›¸å½“) / toilet(ç™½ç›¸å½“)
let cells = Array(64).fill(null);

// ç›¤é¢ç”Ÿæˆ
for (let i = 0; i < 64; i++) {
  const cell = document.createElement('div');
  cell.className = 'cell';
  cell.addEventListener('click', () => tryPlace(i));
  board.appendChild(cell);
}

// åˆæœŸé…ç½®ï¼ˆä¸­å¤®4ã¤ï¼‰
cells[27] = 'toilet'; cells[28] = 'poop';
cells[35] = 'poop';   cells[36] = 'toilet';
render();

function render(){
  [...board.children].forEach((cell, i) => {
    cell.innerHTML = '';
    if (cells[i]) {
      const p = document.createElement('div');
      p.className = 'piece';
      p.textContent = cells[i] === 'poop' ? 'ğŸ’©' : 'ğŸš½';
      cell.appendChild(p);
    }
  });
  turnLabel.textContent = turn === 'poop' ? 'ğŸ’© ã†ã‚“ã“' : 'ğŸš½ ä¾¿å™¨';
}

function tryPlace(index){
  if (cells[index]) return; // æ—¢ã«ç½®ã„ã¦ã‚ã‚‹
  const flips = getFlips(index, turn);
  if (flips.length === 0) return; // åè»¢ã§ããªã„å ´æ‰€ã¯ç„¡è¦–
  cells[index] = turn;
  for (const f of flips) cells[f] = turn;
  turn = (turn === 'poop') ? 'toilet' : 'poop';
  render();
}

// 8æ–¹å‘ã™ã¹ã¦ã§åè»¢å¯¾è±¡ã‚’å–å¾—
function getFlips(index, color){
  const dirs = [1,-1,8,-8,9,-9,7,-7]; // â†’ â† â†“ â†‘ â†˜ â†– â†™ â†—
  let all = [];
  for (const d of dirs){
    const line = collectDirection(index, d, color);
    if (line.length) all = all.concat(line);
  }
  return all;
}

function collectDirection(start, dir, color){
  const flips = [];
  let i = start;

  while (true){
    const row = Math.floor(i/8), col = i%8;
    // æ¬¡ã«é€²ã‚ã‚‹ã‹å¢ƒç•Œãƒã‚§ãƒƒã‚¯
    if ((dir === 1  && col === 7) || (dir === -1 && col === 0) ||
        (dir === 8  && row === 7) || (dir === -8 && row === 0) ||
        (dir === 9  && (row === 7 || col === 7)) ||
        (dir === -9 && (row === 0 || col === 0)) ||
        (dir === 7  && (row === 7 || col === 0)) ||
        (dir === -7 && (row === 0 || col === 7))) {
      return []; // ç›¤å¤–
    }
    i += dir;
    if (i < 0 || i >= 64) return [];

    if (!cells[i]) return []; // ç©ºãƒã‚¹ã«å½“ãŸã£ãŸã‚‰ä¸æˆç«‹
    if (cells[i] === color){
      return flips.length ? flips : []; // è‡ªåˆ†è‰²ã«åˆ°é”ï¼šé–“ã«ç›¸æ‰‹è‰²ãŒ1ã¤ä»¥ä¸Šãªã‚‰OK
    } else {
      flips.push(i); // ç›¸æ‰‹è‰²ã‚’è²¯ã‚ã‚‹
    }
  }
}
</script>
</body>
</html>
